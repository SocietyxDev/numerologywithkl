<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxury Numerology Report</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #5d4e6d;
            --secondary-color: #8a6e4b;
            --accent-color: #a38f80;
            --light-color: #f8f5f2;
            --dark-color: #2a2118;
            --highlight-color: #f0e6d2;
            --gold-color: #c5a267;
            --grid-gap: 25px;
            --success-color: #4caf50;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            background-color: #f9f7f3;
            color: var(--dark-color);
            line-height: 1.7;
            font-family: 'Montserrat', sans-serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px;
        }
        
        .login-container, .form-container, .chart-container, .admin-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            padding: 40px;
            margin-bottom: 40px;
            border: 1px solid #e8e2d9;
        }
        
        h1, h2 {
            font-family: 'Playfair Display', serif;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 25px;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        
        h1 {
            font-size: 2.5rem;
            border-bottom: 2px solid var(--gold-color);
            padding-bottom: 15px;
            display: inline-block;
        }
        
        h2 {
            font-size: 2rem;
            margin-top: 10px;
        }
        
        h3 {
            font-family: 'Playfair Display', serif;
            color: var(--secondary-color);
            margin: 0 0 20px 0;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--gold-color);
            font-size: 1.4rem;
            font-weight: 400;
            letter-spacing: 0.3px;
        }
        
        h4 {
            font-family: 'Montserrat', sans-serif;
            color: var(--primary-color);
            margin: 20px 0 10px;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 0.95rem;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 14px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
            background-color: var(--light-color);
            font-family: 'Montserrat', sans-serif;
        }
        
        input:focus, textarea:focus, select:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(138, 110, 75, 0.2);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
            line-height: 1.6;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            display: block;
            width: 100%;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: 'Montserrat', sans-serif;
        }
        
        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .error-message {
            color: #d33;
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .success-message {
            color: var(--success-color);
            margin-top: 15px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .chart-box {
            background-color: var(--light-color);
            border-radius: 8px;
            padding: 40px;
            margin-top: 20px;
            border: 1px solid #e8e2d9;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--grid-gap);
            margin-bottom: var(--grid-gap);
        }
        
        .chart-section {
            background-color: white;
            border-radius: 6px;
            padding: 25px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.03);
            border: 1px solid #f0ebe5;
            position: relative;
        }
        
        .chart-section.highlight {
            background-color: var(--highlight-color);
            border-left: 4px solid var(--gold-color);
        }
        
        .chart-section.full-width {
            grid-column: 1 / -1;
        }
        
        .numbers-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .number-box {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: white;
            border-radius: 6px;
            padding: 20px 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
            min-height: 90px;
            transition: all 0.3s;
            border: 1px solid #e8e2d9;
        }
        
        .number-value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
            font-family: 'Playfair Display', serif;
        }
        
        .number-label {
            font-size: 11px;
            color: var(--dark-color);
            opacity: 0.8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .number-box.present {
            background-color: #f0f7f0;
            border: 1px solid #c8e0c8;
        }
        
        .number-box.missing {
            background-color: #fdf0f0;
            border: 1px solid #f0c8c8;
        }
        
        .chart-item {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }
        
        .chart-label {
            font-weight: 600;
            min-width: 180px;
            color: var(--primary-color);
            font-size: 0.95rem;
        }
        
        .chart-value {
            flex: 1;
            font-size: 0.95rem;
            line-height: 1.7;
        }
        
        .chart-value strong {
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        .actions {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }
        
        .actions button {
            flex: 1;
        }
        
        .secondary-btn {
            background-color: var(--accent-color);
        }
        
        .secondary-btn:hover {
            background-color: #9a826b;
        }
        
        .success-btn {
            background-color: var(--success-color);
        }
        
        .success-btn:hover {
            background-color: #3d8b40;
        }
        
        .hidden {
            display: none;
        }
        
        .intro-text {
            font-style: italic;
            text-align: center;
            margin-bottom: 30px;
            color: #666;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .footer-note {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e8e2d9;
            font-size: 0.9rem;
            color: #666;
            text-align: center;
            line-height: 1.7;
        }
        
        .edit-icon {
            position: absolute;
            top: 15px;
            right: 15px;
            color: var(--accent-color);
            cursor: pointer;
            font-size: 18px;
            opacity: 0.7;
            transition: all 0.3s;
        }
        
        .edit-icon:hover {
            opacity: 1;
            color: var(--secondary-color);
        }
        
        .editable-title {
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .editable-title:hover {
            background-color: rgba(0,0,0,0.05);
        }
        
        .title-input {
            font-family: 'Playfair Display', serif;
            font-size: 1.4rem;
            border: 1px solid var(--gold-color);
            padding: 5px 10px;
            width: 100%;
            background-color: var(--highlight-color);
        }
        
        .watermark {
            position: fixed;
            bottom: 20px;
            right: 20px;
            opacity: 0.2;
            font-size: 0.8rem;
            color: var(--dark-color);
        }
        
        .admin-controls {
            margin-top: 30px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 8px;
        }
        
        .field-toggle-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .field-toggle {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }
        
        .field-toggle:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .field-toggle input {
            width: auto;
            margin-right: 10px;
        }
        
        .field-toggle label {
            margin-bottom: 0;
            flex: 1;
            cursor: pointer;
        }
        
        .pdf-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .pdf-options select {
            flex: 1;
        }
        
        .add-section {
            margin-top: 20px;
        }
        
        .custom-section {
            margin-top: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 6px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .custom-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .remove-section {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }
        
        @media (max-width: 900px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
            
            .numbers-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .field-toggle-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .login-container, .form-container, .chart-container, .admin-container {
                padding: 30px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            h2 {
                font-size: 1.6rem;
            }
            
            .actions {
                flex-direction: column;
                gap: 15px;
            }
            
            .chart-item {
                flex-direction: column;
            }
            
            .chart-label {
                min-width: auto;
                margin-bottom: 8px;
            }
            
            .numbers-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .pdf-options {
                flex-direction: column;
            }
        }
        
        /* Custom toggle switch */
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--success-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div id="login-section" class="login-container">
            <h1>Numerologist Portal</h1>
            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" placeholder="Enter your username">
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password">
            </div>
            <button id="login-btn">Login</button>
            <div id="login-error" class="error-message hidden">Invalid username or password</div>
        </div>
        
        <!-- Main App (hidden initially) -->
        <div id="app-section" class="hidden">
            <!-- Admin Controls -->
            <div class="admin-container hidden" id="admin-panel">
                <h2>Admin Controls</h2>
                <div class="admin-controls">
                    <h3>Toggle Report Fields</h3>
                    <div class="field-toggle-container" id="standard-fields">
                        <!-- Standard fields will be added here by JavaScript -->
                    </div>
                    
                    <h3 style="margin-top: 30px;">PDF Options</h3>
                    <div class="pdf-options">
                        <select id="pdf-orientation">
                            <option value="portrait">Portrait</option>
                            <option value="landscape">Landscape</option>
                        </select>
                        <select id="pdf-format">
                            <option value="a4">A4</option>
                            <option value="letter">Letter</option>
                            <option value="a5">A5</option>
                        </select>
                    </div>
                    
                    <div class="add-section">
                        <h3>Add Custom Section</h3>
                        <div class="form-group">
                            <label for="new-section-title">Section Title</label>
                            <input type="text" id="new-section-title" placeholder="Enter section title">
                        </div>
                        <div class="form-group">
                            <label for="new-section-content">Content</label>
                            <textarea id="new-section-content" placeholder="Enter section content"></textarea>
                        </div>
                        <button id="add-section-btn" class="success-btn">Add Custom Section</button>
                        <div id="add-section-success" class="success-message hidden"></div>
                    </div>
                    
                    <div id="custom-sections-container">
                        <!-- Custom sections will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Input Form -->
            <div class="form-container">
                <h2>Numerology Report Generator</h2>
                <p class="intro-text">Create a bespoke numerology report with this premium editor. All fields can be customized before generating the final report.</p>
                <form id="numerology-form">
                    <div class="form-group">
                        <label for="full-name">Client Full Name</label>
                        <input type="text" id="full-name" required>
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth</label>
                        <input type="date" id="dob" required>
                    </div>
                    
                    <!-- Standard fields will be added here by JavaScript -->
                    <div id="form-fields-container"></div>
                    
                    <div class="form-group">
                        <label for="report-title">Report Title</label>
                        <input type="text" id="report-title" value="Personal Numerology Report">
                    </div>
                    <button type="submit">Generate Premium Report</button>
                </form>
            </div>
            
            <!-- Chart Display -->
            <div id="chart-section" class="chart-container hidden">
                <div id="chart-box" class="chart-box">
                    <!-- Chart content will be inserted here by JavaScript -->
                </div>
                <div class="actions">
                    <button id="download-btn">Download as PDF</button>
                    <button id="new-chart-btn" class="secondary-btn">Create New Report</button>
                    <button id="edit-report-btn" class="secondary-btn">Edit Report</button>
                    <button id="admin-toggle-btn" class="secondary-btn">Admin Panel</button>
                </div>
            </div>
        </div>
    </div>

    <div class="watermark">Luxury Numerology Report Generator</div>

    <script>
        // DOM Elements
        const loginSection = document.getElementById('login-section');
        const appSection = document.getElementById('app-section');
        const loginBtn = document.getElementById('login-btn');
        const loginError = document.getElementById('login-error');
        const numerologyForm = document.getElementById('numerology-form');
        const chartSection = document.getElementById('chart-section');
        const chartBox = document.getElementById('chart-box');
        const downloadBtn = document.getElementById('download-btn');
        const newChartBtn = document.getElementById('new-chart-btn');
        const editReportBtn = document.getElementById('edit-report-btn');
        const adminPanel = document.getElementById('admin-panel');
        const adminToggleBtn = document.getElementById('admin-toggle-btn');
        const standardFieldsContainer = document.getElementById('standard-fields');
        const formFieldsContainer = document.getElementById('form-fields-container');
        const customSectionsContainer = document.getElementById('custom-sections-container');
        const addSectionBtn = document.getElementById('add-section-btn');
        const addSectionSuccess = document.getElementById('add-section-success');
        
        // Hardcoded credentials
        const CORRECT_USERNAME = 'gaurav';
        const CORRECT_PASSWORD = 'gaurav123';
        let isAdmin = false;
        
        // Standard fields configuration
        const standardFields = [
            { id: 'life-path', label: 'Life Path Number', type: 'number', required: true },
            { id: 'destiny', label: 'Destiny Number', type: 'number', required: true },
            { id: 'soul-urge', label: 'Soul Urge Number', type: 'number', required: true },
            { id: 'personality', label: 'Personality Number', type: 'number', required: true },
            { id: 'lucky-numbers', label: 'Lucky Numbers', type: 'text', required: false },
            { id: 'kua-number', label: 'Kua Number', type: 'number', required: false },
            { id: 'missing-numbers', label: 'Missing Numbers', type: 'text', required: false },
            { id: 'challenges', label: 'Challenges Due to Missing Numbers', type: 'textarea', required: false },
            { id: 'remedies', label: 'Remedies & Solutions', type: 'textarea', required: false },
            { id: 'notes', label: 'Additional Notes', type: 'textarea', required: false }
        ];
        
        // Custom sections
        let customSections = [];
        
        // Initialize the application
        function initApp() {
            // Create standard field toggles
            standardFields.forEach(field => {
                // Add to toggle container
                const toggleHtml = `
                    <div class="field-toggle">
                        <label class="switch">
                            <input type="checkbox" id="toggle-${field.id}" checked>
                            <span class="slider"></span>
                        </label>
                        <label for="toggle-${field.id}">${field.label}</label>
                    </div>
                `;
                standardFieldsContainer.insertAdjacentHTML('beforeend', toggleHtml);
                
                // Add to form container
                const formGroupHtml = `
                    <div class="form-group" id="${field.id}-group">
                        <label for="${field.id}">${field.label}</label>
                        ${field.type === 'textarea' ? 
                            `<textarea id="${field.id}" ${field.required ? 'required' : ''}></textarea>` :
                            `<input type="${field.type}" id="${field.id}" ${field.required ? 'required' : ''} ${field.type === 'number' ? 'min="1" max="9"' : ''}>`
                        }
                    </div>
                `;
                formFieldsContainer.insertAdjacentHTML('beforeend', formGroupHtml);
            });
            
            // Load any saved custom sections
            loadCustomSections();
        }
        
        // Load custom sections from localStorage
        function loadCustomSections() {
            const savedSections = localStorage.getItem('numerologyCustomSections');
            if (savedSections) {
                customSections = JSON.parse(savedSections);
                renderCustomSections();
            }
        }
        
        // Save custom sections to localStorage
        function saveCustomSections() {
            localStorage.setItem('numerologyCustomSections', JSON.stringify(customSections));
        }
        
        // Render custom sections in admin panel
        function renderCustomSections() {
            customSectionsContainer.innerHTML = '';
            
            if (customSections.length > 0) {
                const heading = document.createElement('h3');
                heading.textContent = 'Custom Sections';
                customSectionsContainer.appendChild(heading);
                
                customSections.forEach((section, index) => {
                    const sectionHtml = `
                        <div class="custom-section" data-index="${index}">
                            <div class="custom-section-header">
                                <h4>${section.title}</h4>
                                <button class="remove-section" data-index="${index}">Remove</button>
                            </div>
                            <p>${section.content}</p>
                        </div>
                    `;
                    customSectionsContainer.insertAdjacentHTML('beforeend', sectionHtml);
                });
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-section').forEach(button => {
                    button.addEventListener('click', function() {
                        const index = parseInt(this.getAttribute('data-index'));
                        customSections.splice(index, 1);
                        saveCustomSections();
                        renderCustomSections();
                    });
                });
            }
        }
        
        // Add a new custom section
        function addCustomSection() {
            const title = document.getElementById('new-section-title').value.trim();
            const content = document.getElementById('new-section-content').value.trim();
            
            if (!title || !content) {
                addSectionSuccess.textContent = 'Please enter both title and content';
                addSectionSuccess.classList.remove('hidden');
                return;
            }
            
            customSections.push({
                title: title,
                content: content
            });
            
            saveCustomSections();
            renderCustomSections();
            
            // Clear inputs
            document.getElementById('new-section-title').value = '';
            document.getElementById('new-section-content').value = '';
            
            // Show success message
            addSectionSuccess.textContent = 'Custom section added successfully!';
            addSectionSuccess.classList.remove('hidden');
            
            // Hide message after 3 seconds
            setTimeout(() => {
                addSectionSuccess.classList.add('hidden');
            }, 3000);
        }
        
        // Login functionality
        loginBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === CORRECT_USERNAME && password === CORRECT_PASSWORD) {
                loginSection.classList.add('hidden');
                appSection.classList.remove('hidden');
                loginError.classList.add('hidden');
                isAdmin = true;
                adminPanel.classList.remove('hidden');
                initApp();
            } else {
                loginError.classList.remove('hidden');
            }
        });
        
        // Form submission
        numerologyForm.addEventListener('submit', (e) => {
            e.preventDefault();
            generateReport();
        });
        
        // Toggle admin panel
        adminToggleBtn.addEventListener('click', () => {
            adminPanel.classList.toggle('hidden');
        });
        
        // Add custom section button
        addSectionBtn.addEventListener('click', (e) => {
            e.preventDefault();
            addCustomSection();
        });
        
        // Generate the report
        function generateReport() {
            // Get form values
            const fullName = document.getElementById('full-name').value;
            const dob = document.getElementById('dob').value;
            const reportTitle = document.getElementById('report-title').value || 'Personal Numerology Report';
            
            // Format date for display
            const formattedDate = dob ? new Date(dob).toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }) : '';
            
            // Collect all field values
            const fieldValues = {};
            standardFields.forEach(field => {
                if (document.getElementById(`toggle-${field.id}`).checked) {
                    fieldValues[field.id] = document.getElementById(field.id).value;
                }
            });
            
            // Determine present numbers
            const presentNumbers = new Set([
                fieldValues['life-path'], 
                fieldValues['destiny'], 
                fieldValues['soul-urge'], 
                fieldValues['personality'], 
                fieldValues['kua-number'],
                ...(fieldValues['lucky-numbers'] ? fieldValues['lucky-numbers'].split(',').map(num => num.trim()) : [])
            ]);
            
            // Convert missing numbers to array
            const missingNumbersArray = fieldValues['missing-numbers'] ? 
                fieldValues['missing-numbers'].split(',').map(num => num.trim()) : [];
            
            // Generate report HTML
            let reportHTML = `
                <h2 contenteditable="true" class="editable-title">${reportTitle}</h2>
                <div class="intro-text">
                    <p>This personalized numerology report for <strong>${fullName}</strong> reveals key insights about your life path, challenges, and opportunities based on your numbers.</p>
                </div>
                
                <div class="chart-grid">
                    <!-- Numbers Present Section -->
                    <div class="chart-section full-width">
                        <h3 contenteditable="true" class="editable-title">Numbers Present in Your Chart</h3>
                        <div class="numbers-grid">
                            ${[1,2,3,4,5,6,7,8,9].map(num => {
                                const isPresent = presentNumbers.has(num.toString());
                                const isMissing = missingNumbersArray.includes(num.toString());
                                return `
                                    <div class="number-box ${isPresent ? 'present' : ''} ${isMissing ? 'missing' : ''}">
                                        <div class="number-value">${num}</div>
                                        <div class="number-label">
                                            ${isPresent ? 'Present' : isMissing ? 'Missing' : ''}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- Core Numbers Section -->
                    <div class="chart-section">
                        <h3 contenteditable="true" class="editable-title">Core Numbers</h3>
                        <div class="chart-item">
                            <div class="chart-label" contenteditable="true">Full Name</div>
                            <div class="chart-value">${fullName}</div>
                        </div>
                        <div class="chart-item">
                            <div class="chart-label" contenteditable="true">Date of Birth</div>
                            <div class="chart-value">${formattedDate}</div>
                        </div>
            `;
            
            // Add Life Path if enabled
            if (document.getElementById('toggle-life-path').checked && fieldValues['life-path']) {
                reportHTML += `
                        <div class="chart-item">
                            <div class="chart-label" contenteditable="true">Life Path</div>
                            <div class="chart-value"><strong>${fieldValues['life-path']}</strong> - ${getLifePathMeaning(fieldValues['life-path'])}</div>
                        </div>
                `;
            }
            
            // Add Destiny if enabled
            if (document.getElementById('toggle-destiny').checked && fieldValues['destiny']) {
                reportHTML += `
                        <div class="chart-item">
                            <div class="chart-label" contenteditable="true">Destiny</div>
                            <div class="chart-value"><strong>${fieldValues['destiny']}</strong> - ${getDestinyMeaning(fieldValues['destiny'])}</div>
                        </div>
                `;
            }
            
            reportHTML += `
                    </div>
                    
                    <!-- Secondary Numbers Section -->
                    <div class="chart-section">
                        <h3 contenteditable="true" class="editable-title">Personality Numbers</h3>
            `;
            
            // Add Soul Urge if enabled
            if (document.getElementById('toggle-soul-urge').checked && fieldValues['soul-urge']) {
                reportHTML += `
                        <div class="chart-item">
                            <div class="chart-label" contenteditable="true">Soul Urge</div>
                            <div class="chart-value"><strong>${fieldValues['soul-urge']}</strong> - ${getSoulUrgeMeaning(fieldValues['soul-urge'])}</div>
                        </div>
                `;
            }
            
            // Add Personality if enabled
            if (document.getElementById('toggle-personality').checked && fieldValues['personality']) {
                reportHTML += `
                        <div class="chart-item">
                            <div class="chart-label" contenteditable="true">Personality</div>
                            <div class="chart-value"><strong>${fieldValues['personality']}</strong> - ${getPersonalityMeaning(fieldValues['personality'])}</div>
                        </div>
                `;
            }
            
            // Add Kua if enabled
            if (document.getElementById('toggle-kua-number').checked && fieldValues['kua-number']) {
                reportHTML += `
                        <div class="chart-item">
                            <div class="chart-label" contenteditable="true">Kua Number</div>
                            <div class="chart-value"><strong>${fieldValues['kua-number'] || '-'}</strong> ${fieldValues['kua-number'] ? getKuaDirection(fieldValues['kua-number']) : ''}</div>
                        </div>
                `;
            }
            
            reportHTML += `
                        <div class="chart-item">
                            <div class="chart-label" contenteditable="true">Lucky Numbers</div>
                            <div class="chart-value"><strong>${fieldValues['lucky-numbers'] || '-'}</strong></div>
                        </div>
                    </div>
            `;
            
            // Add Missing Numbers if enabled
            if (document.getElementById('toggle-missing-numbers').checked && fieldValues['missing-numbers']) {
                reportHTML += `
                    <!-- Missing Numbers Section -->
                    <div class="chart-section highlight">
                        <h3 contenteditable="true" class="editable-title">Missing Numbers Analysis</h3>
                        <div class="chart-item">
                            <div class="chart-label" contenteditable="true">Missing Numbers</div>
                            <div class="chart-value"><strong>${fieldValues['missing-numbers']}</strong></div>
                        </div>
                        ${fieldValues['challenges'] ? `
                        <div class="chart-item">
                            <div class="chart-label" contenteditable="true">Potential Challenges</div>
                            <div class="chart-value">${fieldValues['challenges']}</div>
                        </div>
                        ` : ''}
                    </div>
                `;
                
                // Add Remedies if enabled
                if (document.getElementById('toggle-remedies').checked) {
                    reportHTML += `
                    <!-- Remedies Section -->
                    <div class="chart-section highlight">
                        <h3 contenteditable="true" class="editable-title">Remedies & Solutions</h3>
                        ${fieldValues['remedies'] ? `
                        <div class="chart-value" contenteditable="true">${fieldValues['remedies']}</div>
                        ` : '<div class="chart-value" contenteditable="true">No specific remedies provided</div>'}
                    </div>
                    `;
                }
            }
            
            // Add Notes if enabled
            if (document.getElementById('toggle-notes').checked && fieldValues['notes']) {
                reportHTML += `
                    <!-- Additional Notes Section -->
                    <div class="chart-section full-width">
                        <h3 contenteditable="true" class="editable-title">Additional Insights</h3>
                        <div class="chart-value" contenteditable="true">${fieldValues['notes']}</div>
                    </div>
                `;
            }
            
            // Add custom sections
            customSections.forEach(section => {
                reportHTML += `
                    <div class="chart-section">
                        <h3 contenteditable="true" class="editable-title">${section.title}</h3>
                        <div class="chart-value" contenteditable="true">${section.content}</div>
                    </div>
                `;
            });
            
            reportHTML += `
                </div>
                
                <div class="footer-note">
                    <p>Report generated on ${new Date().toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    })}</p>
                    <p>This report is for personal guidance only. Use this information as a tool for self-discovery and positive growth.</p>
                </div>
            `;
            
            chartBox.innerHTML = reportHTML;
            
            // Show the chart section
            chartSection.classList.remove('hidden');
            
            // Scroll to the chart
            chartSection.scrollIntoView({ behavior: 'smooth' });
            
            // Make all editable titles focusable
            document.querySelectorAll('.editable-title').forEach(title => {
                title.addEventListener('click', function() {
                    this.focus();
                });
            });
        }
        
        // Helper functions for number meanings
        function getLifePathMeaning(number) {
            const meanings = {
                1: "The independent leader, pioneering spirit",
                2: "The cooperative peacemaker, sensitive and intuitive",
                3: "The creative communicator, expressive and joyful",
                4: "The practical builder, organized and reliable",
                5: "The freedom-loving adventurer, adaptable and progressive",
                6: "The nurturing caregiver, responsible and protective",
                7: "The spiritual seeker, analytical and wise",
                8: "The ambitious achiever, business-minded and goal-oriented",
                9: "The humanitarian, compassionate and artistic"
            };
            return meanings[number] || "";
        }
        
        function getDestinyMeaning(number) {
            const meanings = {
                1: "To develop independence and leadership qualities",
                2: "To work with others and develop diplomacy",
                3: "To express creativity and inspire others",
                4: "To build solid foundations through hard work",
                5: "To embrace change and freedom in life",
                6: "To nurture and care for others",
                7: "To seek knowledge and spiritual understanding",
                8: "To achieve material success and personal power",
                9: "To serve humanity with compassion"
            };
            return meanings[number] || "";
        }
        
        function getSoulUrgeMeaning(number) {
            const meanings = {
                1: "Desires independence and personal achievement",
                2: "Seeks harmony, partnership and emotional security",
                3: "Craves creative expression and social interaction",
                4: "Longs for stability, order and systems",
                5: "Yearns for freedom, variety and new experiences",
                6: "Desires to nurture, teach and create harmony",
                7: "Seeks knowledge, solitude and spiritual growth",
                8: "Aspires to material success and influence",
                9: "Wants to make a difference and help others"
            };
            return meanings[number] || "";
        }
        
        function getPersonalityMeaning(number) {
            const meanings = {
                1: "Appears confident, ambitious and self-reliant",
                2: "Seems gentle, tactful and diplomatic",
                3: "Comes across as enthusiastic, charming and optimistic",
                4: "Appears practical, disciplined and trustworthy",
                5: "Seems adventurous, versatile and energetic",
                6: "Appears responsible, protective and caring",
                7: "Seems thoughtful, analytical and reserved",
                8: "Appears authoritative, goal-oriented and successful",
                9: "Seems compassionate, artistic and idealistic"
            };
            return meanings[number] || "";
        }
        
        function getKuaDirection(number) {
            if (!number) return "";
            const directions = {
                1: "(North - Water Element)",
                2: "(Southwest - Earth Element)",
                3: "(East - Wood Element)",
                4: "(Southeast - Wood Element)",
                5: "(Center - Earth Element)",
                6: "(Northwest - Metal Element)",
                7: "(West - Metal Element)",
                8: "(Northeast - Earth Element)",
                9: "(South - Fire Element)"
            };
            return directions[number] || "";
        }
        
        // Download as PDF
        downloadBtn.addEventListener('click', async () => {
            // Create a clone of the chart box to avoid modifying the original
            const element = chartBox.cloneNode(true);
            
            // Remove contenteditable attributes from the clone
            element.querySelectorAll('[contenteditable]').forEach(el => {
                el.removeAttribute('contenteditable');
            });
            
            // Add the clone to the document temporarily
            element.style.position = 'absolute';
            element.style.left = '-9999px';
            element.style.width = '100%';
            document.body.appendChild(element);
            
            // Get PDF options
            const orientation = document.getElementById('pdf-orientation').value;
            const format = document.getElementById('pdf-format').value;
            
            // PDF options
            const opt = {
                margin: 15,
                filename: 'luxury-numerology-report.pdf',
                image: { 
                    type: 'jpeg', 
                    quality: 0.98 
                },
                html2canvas: { 
                    scale: 2,
                    logging: false,
                    useCORS: true,
                    letterRendering: true,
                    scrollX: 0,
                    scrollY: 0,
                    windowWidth: element.scrollWidth,
                    windowHeight: element.scrollHeight
                },
                jsPDF: { 
                    unit: 'mm', 
                    format: format,
                    orientation: orientation,
                    hotfixes: ["px_scaling"]
                }
            };
            
            try {
                // Show loading state
                downloadBtn.textContent = 'Generating PDF...';
                downloadBtn.disabled = true;
                
                // Generate PDF
                await html2pdf().set(opt).from(element).save();
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            } finally {
                // Remove the temporary element
                document.body.removeChild(element);
                
                // Reset button state
                downloadBtn.textContent = 'Download as PDF';
                downloadBtn.disabled = false;
            }
        });
        
        // New chart button
        newChartBtn.addEventListener('click', () => {
            chartSection.classList.add('hidden');
            numerologyForm.reset();
            document.getElementById('full-name').focus();
        });
        
        // Edit report button
        editReportBtn.addEventListener('click', () => {
            generateReport();
        });
        
        // Toggle form fields based on admin settings
        document.addEventListener('change', function(e) {
            if (e.target && e.target.id && e.target.id.startsWith('toggle-')) {
                const fieldId = e.target.id.replace('toggle-', '');
                const formGroup = document.getElementById(`${fieldId}-group`);
                if (formGroup) {
                    formGroup.style.display = e.target.checked ? 'block' : 'none';
                }
            }
        });
    </script>
</body>
</html>
